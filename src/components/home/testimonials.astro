---
import { Image } from "astro:assets";
import testimonialsData from "./testimonials.json";
import avatarSrc from "@/assets/testimonials/avatar.png";

// TODO use content layer to load testimonials to make sure we validate the data first
interface Testimonial {
  name: string;
  role: string;
  company: string;
  profile_image: string;
  video?: string;
  quote?: string;
}
console.log(testimonialsData);

const testimonials: Testimonial[] = testimonialsData.testimonials;
---

<section class="py-16">
  <div class="container mx-auto px-4">
    <h2 class="mb-12 text-3xl font-bold">Testimonials</h2>
    <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
      {
        testimonials.map(testimonial => (
          <div class="overflow-hidden rounded-lg bg-white shadow-md">
            {testimonial.video && (
              <div class="relative">
                <video
                  src={testimonial.video}
                  class="aspect-[9/16] w-full object-cover"
                  id={`video-${testimonial.name}`}
                />
                <div
                  class="absolute inset-0 flex cursor-pointer items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300"
                  id={`overlay-${testimonial.name}`}
                  onclick={`
                    document.getElementById('video-${testimonial.name}').play();
                    this.style.opacity = '0';
                    setTimeout(() => this.style.display = 'none', 300);
                  `}
                >
                  <button class="text-4xl text-white" aria-label="Play video">
                    â–¶
                  </button>
                </div>
              </div>
            )}
            <div class="p-6">
              {testimonial.quote && (
                <p class="mb-4 text-sm">{testimonial.quote}</p>
              )}
              <div class="flex items-center">
                <Image
                  src={avatarSrc}
                  alt={testimonial.name}
                  width={40}
                  height={40}
                  class="mr-3 h-10 w-10 rounded-full"
                />
                <div>
                  <p class="font-bold">{testimonial.name}</p>
                  <p class="text-sm text-gray-600">{testimonial.role}</p>
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
